#######################################################################################################################################################################################################
#
# Changes to the function
# General
#     2022-Feb-01: migrate function to version v0.3
#     2022-Feb-01: add documentation
#     2022-Feb-01: rename the function to relative_hydraulic_conductance
#     2022-Feb-01: remove viscosity correction
#
#######################################################################################################################################################################################################
"""
This function return the hydraulic conductance ralative to maximum. The supported methods are

$(METHODLIST)

"""
function relative_hydraulic_conductance end


#######################################################################################################################################################################################################
#
# Changes to the method
# General
#     2022-Feb-01: add method for ClimaCache.LogisticVC
#     2022-Feb-01: add documentation
#
#######################################################################################################################################################################################################
"""

    relative_hydraulic_conductance(vc::LogisticVC{FT}, p_25::FT) where {FT<:AbstractFloat}

Return the hydraulic conductance ralative to maximum at reference temperature, given
- `vc` `ClimaCache.LogisticVC` type vulnerability curve
- `p_25` Equivalent xylem water pressure at 298.15 K in `[MPa]` (surface tension correction made)

---
# Examples
```julia
vc = LogisticVC{Float64}(2, 2);
kr = relative_hydraulic_conductance(vc, -2.0);
```
"""
relative_hydraulic_conductance(vc::LogisticVC{FT}, p_25::FT) where {FT<:AbstractFloat} = (
    if p_25 >= 0
        return FT(1)
    end;

    @unpack A, B = vc;

    return max( eps(FT), (1 - 1/(1 + A * exp(B * p_25))) * (A+1)/A )
);


#######################################################################################################################################################################################################
#
# Changes to the method
# General
#     2022-Feb-01: add method for ClimaCache.PowerVC
#     2022-Feb-01: add documentation
#
#######################################################################################################################################################################################################
"""

    relative_hydraulic_conductance(vc::PowerVC{FT}, p_25::FT) where {FT<:AbstractFloat}

Return the hydraulic conductance ralative to maximum at reference temperature, given
- `vc` `ClimaCache.PowerVC` type vulnerability curve
- `p_25` Equivalent xylem water pressure at 298.15 K in `[MPa]` (surface tension correction made)

---
# Examples
```julia
vc = PowerVC{Float64}(2, 2);
kr = relative_hydraulic_conductance(vc, -2.0);
```
"""
relative_hydraulic_conductance(vc::PowerVC{FT}, p_25::FT) where {FT<:AbstractFloat} = (
    if p_25>=0
        return FT(1)
    end;

    @unpack A, B = vc;

    return max( eps(FT), 1 / (1 + A*(-p_25)^B) )
);


#######################################################################################################################################################################################################
#
# Changes to the method
# General
#     2022-Feb-01: add method for ClimaCache.WeibullVC
#     2022-Feb-01: add documentation
#
#######################################################################################################################################################################################################
"""

    relative_hydraulic_conductance(vc::WeibullVC{FT}, p_25::FT) where {FT<:AbstractFloat}

Return the hydraulic conductance ralative to maximum at reference temperature, given
- `vc` `ClimaCache.WeibullVC` type vulnerability curve
- `p_25` Equivalent xylem water pressure at 298.15 K in `[MPa]` (surface tension correction made)

---
# Examples
```julia
vc = WeibullVC{Float64}(2, 2);
kr = relative_hydraulic_conductance(vc, -2.0);
```
"""
relative_hydraulic_conductance(vc::WeibullVC{FT}, p_25::FT) where {FT<:AbstractFloat} = (
    if p_25>=0
        return FT(1)
    end;

    @unpack B, C = vc;

    return max( eps(FT), exp( -1 * (-p_25 / B) ^ C ) )
);
